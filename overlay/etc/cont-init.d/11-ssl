#!/usr/bin/with-contenv bash

set -euo pipefail


#======================================================================================================================
# If SSL is not enabled, exit script gracefully
#======================================================================================================================

[[ "${ENABLE_SSL-}" != "1" ]] && bcg-echo "SSL is not enabled." && exit 0


#======================================================================================================================
# SSL directory
#======================================================================================================================

# ensure SSL directory exists
if [ ! -d ${SSL} ] ; then
    bcg-echo "Creating ${SSL}..."
    mkdir -p ${SSL}
    bcg-done
fi


#======================================================================================================================
# If server certificate exists, exit script
#======================================================================================================================

if [ -e ${SERVER_CERT} ] ; then
    bcg-ok "SSL certificates already exist."
    exit 0
fi


#======================================================================================================================
# Call db-generate-certs executable
#======================================================================================================================

db-generate-certs
