#!/bin/sh

set -euo pipefail


#======================================================================================================================
# Add dbadm user.
#======================================================================================================================

bcg-echo "Adding dbadm user..."
bcg-adduser dbadm
bcg-done


#======================================================================================================================
# Get MariaDB version.
#======================================================================================================================

cd /tmp

VERSION=$(cat VERSION)
bcg-debug "install: MariaDB version ${VERSION}."


#======================================================================================================================
# Install MariaDB and dependencies.
#======================================================================================================================

apk add --no-cache \
    bash \
    openssl \
    mariadb=${VERSION} \
    mariadb-client=${VERSION} \
    mariadb-server-utils=${VERSION} \


#======================================================================================================================
# Cleanup.
#======================================================================================================================

rm -rf /etc/my.cnf* /etc/mysql /var/lib/mysql/*


#======================================================================================================================
# Add backup executable to main cron.
#======================================================================================================================

echo "0 */8 * * * /usr/local/bin/db-backup" >> /etc/crontabs/root
