#!/bin/sh

set -euo pipefail


#======================================================================================================================
# Add dbadm user.
#======================================================================================================================

bcg-echo "Adding dbadm user..."
bcg-adduser dbadm
bcg-done


#======================================================================================================================
# Install MariaDB and dependencies.
#======================================================================================================================

MARIADB_VERSION=$(cat /tmp/MARIADB_VERSION)
bcg-echo "Installing MariaDB v${MARIADB_VERSION}..."
apk add --no-cache \
    bash \
    openssl \
    mariadb=${MARIADB_VERSION} \
    mariadb-client=${MARIADB_VERSION} \
    mariadb-server-utils=${MARIADB_VERSION} \


#======================================================================================================================
# Cleanup.
#======================================================================================================================

rm -rf /etc/my.cnf* /etc/mysql /var/lib/mysql/*


#======================================================================================================================
# Add backup executable to main cron.
#======================================================================================================================

echo "0 */8 * * * /usr/local/bin/db-backup" >> /etc/crontabs/root
