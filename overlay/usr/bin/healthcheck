#!/usr/bin/with-contenv bash

#======================================================================================================================
# Copyright (c) 2015 Thomas Boerger <https://webhippie.de>
# Originally from https://github.com/dockhippie/mariadb/blob/master/latest/overlay/etc/s6/mariadb/run
#
# Modifications copyright (c) 2020 Ben Green <https://bcgdesign.com>
#======================================================================================================================

set -eo pipefail

MARIADB_USERNAME=${MARIADB_USERNAME:-root}
MARIADB_PASSWORD=${MARIADB_PASSWORD:-${MARIADB_ROOT_PASSWORD}}

CHECK="$(echo 'SELECT 1;' | mysql -h127.0.0.1 -u$MARIADB_USERNAME -p$MARIADB_PASSWORD 2>/dev/null | head -n1)"

if [[ "$CHECK" == "1" ]] ; then
    exit 0
fi

exit 1
